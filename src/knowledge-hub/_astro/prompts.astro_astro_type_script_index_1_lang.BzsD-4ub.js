import"./prompts.astro_astro_type_script_index_2_lang.B1Za9WIj.js";import{i as q}from"./lit-element.CBixG2jI.js";let m;const C=async()=>(m||(m=new Function("url","return import(url)")("/pagefind/pagefind.js").then(async s=>{const n=s.default||s;return await n.init(),n})),m),$=async(e="",s="tools")=>{const n=e.trim();if(!n)return[];let r;try{console.log("getting pagefind instance"),r=await C()}catch{return null}const a=await r.search(n),c=[];console.log("search",a);for(const o of a.results){const i=await o.data();i.url.includes(`/${s}/`)&&c.push(i)}return c},S=["organisation","governmentBody","userGroup","typeOfTechnology","impact"],F=class extends q{connectedCallback(){const e=this.querySelector("#search-term"),s=this.querySelector("#search-type"),r=new URL(window.location.href).searchParams.get("search");e&&r&&(e.value=r);let a;this.#e(e?.value??"",s?.value),e?.addEventListener("input",()=>{this.#e(e.value,s?.value),clearTimeout(a),a=setTimeout(()=>{e?.value&&posthog.capture("kh_search_input_typed",{search_term:e?.value,page_type:s?.value})},1e3)}),S.forEach(c=>{const o=document.querySelector(`#${c}`);o&&o.addEventListener("change",()=>{e?.value.trim()&&this.#e(e.value,s?.value)})})}async#e(e,s){if(!e.trim()){const t=document.querySelector("usecase-filters");t?t.applyFilters():this.#t();return}let n=[];const r=await $(e,s);console.log("pageFindData",r),r?n=r:n=await(await fetch(`/get-search?search=${e}&type=${s}`)).json();const a=new Set(n.map(t=>t.url.toLowerCase())),c=document.querySelectorAll(".kh-card"),o=document.querySelector("#filtered-count"),i=document.querySelector("#active-filters"),g=document.querySelector("#aria-live-search-results");let u=0;const p=[],d={};if(S.forEach(t=>{const l=document.querySelector(`#${t}`);if(l&&l.value){d[t]=l.value;const f=t.replace(/([A-Z])/g," $1").trim().toLowerCase();p.push(`${f}: <strong>${l.value}</strong>`)}}),c.forEach(t=>{const f=t.querySelector("a")?.href.replace(window.location.origin,"").replace("?directTo=library","")||"",L=a.has(f.toLowerCase());let y=!0;Object.keys(d).forEach(w=>{const E=w.replace(/([A-Z])/g,"-$1").toLowerCase(),v=t.getAttribute(`data-${E}`);(!v||!v.includes(d[w]))&&(y=!1)}),L&&y?(t.classList.remove("hidden"),u++):t.classList.add("hidden")}),o&&(u===c.length?o.textContent="all":o.textContent=u.toString()),g&&(g.textContent=`Showing ${u} of ${c.length} results`),i){const t=[...p];e.trim()&&t.push(`search: <strong>"${e}"</strong>`),t.length>0?i.innerHTML=` filtered by ${t.join(", ")}`:i.innerHTML=""}const h=new URL(window.location.href);e.trim()?h.searchParams.set("search",e):h.searchParams.delete("search"),window.history.pushState({},"",h)}#t(){const e=document.querySelectorAll(".kh-card"),s=document.querySelector("#filtered-count"),n=document.querySelector("#active-filters");e.forEach(a=>{a.classList.remove("hidden")}),s&&(s.textContent="all"),n&&(n.innerHTML="");const r=new URL(window.location.href);r.searchParams.delete("search"),window.history.pushState({},"",r)}};customElements.define("site-search",F);
