import"./tools.astro_astro_type_script_index_2_lang.BTUssW8M.js";import{i as L}from"./lit-element.CBixG2jI.js";const w=["organisation","governmentBody","userGroup","typeOfTechnology","impact"],q=class extends L{connectedCallback(){const e=this.querySelector("#search-term"),s=this.querySelector("#search-type"),r=new URL(window.location.href).searchParams.get("search");e&&r&&(e.value=r);let a;this.#e(e?.value??"",s?.value),e?.addEventListener("input",()=>{this.#e(e.value,s?.value),clearTimeout(a),a=setTimeout(()=>{e?.value&&posthog.capture("kh_search_input_typed",{search_term:e?.value,page_type:s?.value})},1e3)}),w.forEach(n=>{const c=document.querySelector(`#${n}`);c&&c.addEventListener("change",()=>{e?.value.trim()&&this.#e(e.value,s?.value)})})}async#e(e,s){if(!e.trim()){const t=document.querySelector("usecase-filters");t?t.applyFilters():this.#t();return}const r=await(await fetch(`/get-search?search=${e}&type=${s}`)).json(),a=new Set(r.map(t=>t.url)),n=document.querySelectorAll(".kh-card"),c=document.querySelector("#filtered-count"),u=document.querySelector("#active-filters"),m=document.querySelector("#aria-live-search-results");let i=0;const y=[],h={};if(w.forEach(t=>{const o=document.querySelector(`#${t}`);if(o&&o.value){h[t]=o.value;const f=t.replace(/([A-Z])/g," $1").trim().toLowerCase();y.push(`${f}: <strong>${o.value}</strong>`)}}),n.forEach(t=>{const f=t.querySelector("a")?.href.replace(window.location.origin,"").replace("?directTo=library","")||"",g=a.has(f);let v=!0;Object.keys(h).forEach(p=>{const E=p.replace(/([A-Z])/g,"-$1").toLowerCase(),S=t.getAttribute(`data-${E}`);(!S||!S.includes(h[p]))&&(v=!1)}),g&&v?(t.classList.remove("hidden"),i++):t.classList.add("hidden")}),c&&(i===n.length?c.textContent="all":c.textContent=i.toString()),m&&(m.textContent=`Showing ${i} of ${n.length} results`),u){const t=[...y];e.trim()&&t.push(`search: <strong>"${e}"</strong>`),t.length>0?u.innerHTML=` filtered by ${t.join(", ")}`:u.innerHTML=""}const d=new URL(window.location.href);e.trim()?d.searchParams.set("search",e):d.searchParams.delete("search"),window.history.pushState({},"",d)}#t(){const e=document.querySelectorAll(".kh-card"),s=document.querySelector("#filtered-count"),l=document.querySelector("#active-filters");e.forEach(a=>{a.classList.remove("hidden")}),s&&(s.textContent="all"),l&&(l.innerHTML="");const r=new URL(window.location.href);r.searchParams.delete("search"),window.history.pushState({},"",r)}};customElements.define("site-search",q);
