import"./prompts.astro_astro_type_script_index_2_lang.B1Za9WIj.js";import{i as q}from"./lit-element.CBixG2jI.js";let m;const C=async()=>(m||(m=new Function("url","return import(url)")("/pagefind/pagefind.js").then(async s=>{const r=s.default||s;return await r.init(),r})),m),$=async(e="",s="tools")=>{const r=e.trim();if(!r)return[];let n;try{n=await C()}catch{return null}const c=await n.search(r),o=[];for(const a of c.results){const i=await a.data();i.url.includes(`/${s}/`)&&o.push(i)}return o},S=["organisation","governmentBody","userGroup","typeOfTechnology","impact"],F=class extends q{connectedCallback(){const e=this.querySelector("#search-term"),s=this.querySelector("#search-type"),n=new URL(window.location.href).searchParams.get("search");e&&n&&(e.value=n);let c;this.#e(e?.value??"",s?.value),e?.addEventListener("input",()=>{this.#e(e.value,s?.value),clearTimeout(c),c=setTimeout(()=>{e?.value&&posthog.capture("kh_search_input_typed",{search_term:e?.value,page_type:s?.value})},1e3)}),S.forEach(o=>{const a=document.querySelector(`#${o}`);a&&a.addEventListener("change",()=>{e?.value.trim()&&this.#e(e.value,s?.value)})})}async#e(e,s){if(!e.trim()){const t=document.querySelector("usecase-filters");t?t.applyFilters():this.#t();return}let r=[];if(this.getAttribute("data-internal-site")==="true")r=await(await fetch(`/get-search?search=${e}&type=${s}`)).json();else{const t=await $(e,s);t&&(r=t)}const c=new Set(r.map(t=>t.url.toLowerCase())),o=document.querySelectorAll(".kh-card"),a=document.querySelector("#filtered-count"),i=document.querySelector("#active-filters"),p=document.querySelector("#aria-live-search-results");let u=0;const y=[],d={};if(S.forEach(t=>{const l=document.querySelector(`#${t}`);if(l&&l.value){d[t]=l.value;const f=t.replace(/([A-Z])/g," $1").trim().toLowerCase();y.push(`${f}: <strong>${l.value}</strong>`)}}),o.forEach(t=>{const f=t.querySelector("a")?.href.replace(window.location.origin,"").replace("?directTo=library","")||"",L=c.has(f.toLowerCase());let g=!0;Object.keys(d).forEach(w=>{const E=w.replace(/([A-Z])/g,"-$1").toLowerCase(),v=t.getAttribute(`data-${E}`);(!v||!v.includes(d[w]))&&(g=!1)}),L&&g?(t.classList.remove("hidden"),u++):t.classList.add("hidden")}),a&&(u===o.length?a.textContent="all":a.textContent=u.toString()),p&&(p.textContent=`Showing ${u} of ${o.length} results`),i){const t=[...y];e.trim()&&t.push(`search: <strong>"${e}"</strong>`),t.length>0?i.innerHTML=` filtered by ${t.join(", ")}`:i.innerHTML=""}const h=new URL(window.location.href);e.trim()?h.searchParams.set("search",e):h.searchParams.delete("search"),window.history.pushState({},"",h)}#t(){const e=document.querySelectorAll(".kh-card"),s=document.querySelector("#filtered-count"),r=document.querySelector("#active-filters");e.forEach(c=>{c.classList.remove("hidden")}),s&&(s.textContent="all"),r&&(r.innerHTML="");const n=new URL(window.location.href);n.searchParams.delete("search"),window.history.pushState({},"",n)}};customElements.define("site-search",F);
